<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RegExp Equivalence Checker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 800px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 2.5rem;
      font-weight: 300;
    }

    h4 {
      margin: 10px 0px 5px 0px;
    }


    .input-container {
      display: flex;
      gap: 20px;
      margin-bottom: 25px;
    }

    .input-group {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
      font-size: 1.1rem;
    }

    .regex-input-wrapper {
      display: flex;
      align-items: center;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      background: white;
      transition: border-color 0.3s ease;
    }

    .regex-input-wrapper:focus-within {
      border-color: #667eea;
    }

    .regex-slash {
      padding: 15px 8px;
      font-size: 1.2rem;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      user-select: none;
    }

    input[type="text"] {
      flex: 1;
      padding: 15px 8px;
      border: none;
      outline: none;
      font-size: 1rem;
      font-family: 'Courier New', monospace;
      background: transparent;
    }

    ul {
      list-style-position: inside;
    }

    @media (max-width: 768px) {
      .input-container {
        flex-direction: column;
        gap: 25px;
      }
    }

    .button-container {
      text-align: center;
      margin: 30px 0;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 25px;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    button:active {
      transform: translateY(0);
    }

    .result {
      margin-top: 30px;
      padding: 20px;
      border-radius: 10px;
      font-size: 1.1rem;
      display: none;
    }

    .result.equivalent {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .result.not-equivalent {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    .result.error {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
    }

    .counterexamples {
      margin-top: 15px;
      padding: 15px;
      background: #fff8dc;
      border: 1px solid #f0e68c;
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .counterexamples h4 {
      margin-bottom: 10px;
      color: #8b4513;
      font-size: 1rem;
    }

    .examples-list {
      background: #f8f9fa;
      border-radius: 5px;
      padding: 10px;
      margin-bottom: 10px;
    }

    .examples-list code {
      background: #e9ecef;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      margin: 2px;
      display: inline-block;
    }

    .regex-counterexamples {
      margin-top: 15px;
      display: none;
    }

    .info {
      margin-top: 30px;
      padding: 15px;
      background: #e9ecef;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #666;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>RegExp Equivalence Checker</h1>

    <div class="input-container">
      <div class="input-group">
        <label for="regex1">Regular Expression 1:</label>
        <div class="regex-input-wrapper">
          <span class="regex-slash">/</span>
          <input type="text" id="regex1" placeholder="^a{1,3}$" />
          <span class="regex-slash">/</span>
        </div>
        <div class="regex-counterexamples" id="counterexamples1"></div>
      </div>

      <div class="input-group">
        <label for="regex2">Regular Expression 2:</label>
        <div class="regex-input-wrapper">
          <span class="regex-slash">/</span>
          <input type="text" id="regex2" placeholder="^(a|aa|aaa)$" />
          <span class="regex-slash">/</span>
        </div>
        <div class="regex-counterexamples" id="counterexamples2"></div>
      </div>
    </div>

    <div class="button-container">
      <button id="check-equiv-button">Check Equivalence</button>
    </div>

    <div class="result" id="result"></div>

    <div class="info">
      <h4>How to use:</h4>
      Enter two JavaScript regular expressions (without the surrounding slashes) and click "Check Equivalence".
      The tool will determine if both expressions match exactly the same set of strings.
      If they're not equivalent, it will show example strings that demonstrate the difference.

      <h4>Examples:</h4>
      <ul>
        <li><code>a*</code> and <code>a+</code> are not equivalent</li>
        <li><code>a|b</code> and <code>b|a</code> are equivalent</li>
        <li><code>(ab)+</code> and <code>ab(ab)*</code> are equivalent</li>
      </ul>

      <h4>Supported syntax:</h4>
      <ul>
        <li>Quantifiers: <code>a*</code>, <code>a+</code>, <code>a{3,10}</code>, <code>a?</code></li>
        <li>Alternation: <code>a|b</code></li>
        <li>Character classes: <code>.</code>, <code>\w</code>, <code>[a-zA-Z]</code>, ...</li>
        <li>Escaping: <code>\$</code>, <code>\.</code>, ...</li>
        <li>(Non-)capturing groups: <code>(?...)</code>, <code>(...)</code></li>
        <li>Positive/negative lookahead: <code>(?=...)</code>, <code>(?!...)</code></li>
      </ul>

      <h4>Unsupported syntax:</h4>
      <ul>
        <li>RegExp flags: <code>g</code>, <code>i</code>, <code>m</code>, <code>s</code>, <code>u</code>, <code>y</code></li>
        <li>Unicode property escapes: <code>\p{...}</code>, <code>\P{...}</code></li>
        <li>Backreferences: <code>\1</code>, <code>\2</code>, ...</li>
        <li>Lookbehind assertions: <code>(?&lt;=...)</code>, <code>(?&lt;!...)</code></li>
        <li>Word boundary: <code>\b</code>, <code>\B</code></li>
      </ul>

      <h4>Powered by:</h4>
      <a href="https://github.com/gruhn/regex-utils" target="_blank" style="color: #667eea; text-decoration: none;">
        📦 @gruhn/regex-utils
      </a> - TypeScript library for regex equivalence, intersection, complement and other utilities
    </div>
  </div>

  <script type="module">
    // Import the regex-utils library from CDN
    import {
      RB,
      ParseError,
      VeryLargeSyntaxTreeError,
      CacheOverflowError
    } from './dist/index.js';

      document.addEventListener('DOMContentLoaded', () => {
      
      const regex1Input = document.getElementById('regex1');
      const regex2Input = document.getElementById('regex2');
      const checkEquivButton = document.getElementById('check-equiv-button');
      const resultDiv = document.getElementById('result');
      const counterexamples1 = document.getElementById('counterexamples1');
      const counterexamples2 = document.getElementById('counterexamples2');

      function clearResults() {
        resultDiv.style.display = 'none';
        resultDiv.className = 'result';
        counterexamples1.style.display = 'none';
        counterexamples1.innerHTML = '';
        counterexamples2.style.display = 'none';
        counterexamples2.innerHTML = '';       
      }

      // clear results on new input:
      regex1Input.addEventListener('input', () => {
        clearResults()
      })
      regex2Input.addEventListener('input', () => {
        clearResults()
      })

      function checkEquivalence() {
        const pattern1 = regex1Input.value.trim();
        const pattern2 = regex2Input.value.trim();

        // Clear previous results
        clearResults()

        // Validate input
        if (!pattern1 || !pattern2) {
          showResult('Please enter both regular expressions.', 'error');
          return;
        }

        try {
          // First, validate that both patterns are valid JavaScript regex syntax
          const regexA = new RegExp(pattern1);
          const regexB = new RegExp(pattern2);

          // Then compute symmetric difference of the two regex:
          const diffAB = RB(regexA).without(regexB);
          const diffBA = RB(regexB).without(regexA);

          if (diffAB.isEmpty() && diffBA.isEmpty()) {
            // Equivalent
            showResult('✅ The regular expressions are equivalent!<br>Both expressions match exactly the same set of strings.', 'equivalent');
          } else {
            // Not equivalent - show counterexamples under respective text boxes
            showResult('❌ The regular expressions are NOT equivalent.', 'not-equivalent');

            // Show counterexamples under first regex (strings matching first but not second)
            if (!diffAB.isEmpty()) {
              const stringsMatchingAButNotB = Array.from(diffAB.enumerate().take(5));
              if (stringsMatchingAButNotB.length > 0) {
                showCounterexamples(counterexamples1, 'Matches only left regex:', stringsMatchingAButNotB);
              }
            }

            // Show counterexamples under second regex (strings matching second but not first)
            if (!diffBA.isEmpty()) {
              const stringsMatchingBButNotA = Array.from(diffBA.enumerate().take(5));
              if (stringsMatchingBButNotA.length > 0) {
                showCounterexamples(counterexamples2, 'Matches only right regex:', stringsMatchingBButNotA);
              }
            }
          }
        } catch (error) {
          if (error instanceof SyntaxError) {
            showResult(`❌ Invalid regex syntax: ${error.message}<br>Please check that your regular expressions use valid JavaScript regex syntax.`, 'error');
          } else if (error instanceof ParseError) {
            showResult(`🚧 Unsupported regex syntax: The syntax is valid but not yet supported by the tool.<br/><br/>${error.message}`, 'error');
          } else if (error instanceof VeryLargeSyntaxTreeError || error instanceof CacheOverflowError) {
            showResult(`☠️ Excessive resource use detected: This example might be computationally hard.`, 'error');
          } else {
            showResult(`❌ Unexpected error: ${error.message}`, 'error');
          }
        }
      };

      checkEquivButton.addEventListener('click', () => {
        checkEquivalence();
      });
      regex1Input.addEventListener('keyup', (event) => {
        if (event.key === "Enter") {
          checkEquivalence();
        }
      })
      regex2Input.addEventListener('keyup', () => {
        if (event.key === "Enter") {
          checkEquivalence();
        }
      })

      function showResult(message, type) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = message;
        resultDiv.className = `result ${type}`;
        resultDiv.style.display = 'block';
      }

      function showCounterexamples(container, title, examples) {
        let html = '<div class="counterexamples">';
        html += `<h4>${title}</h4>`;
        html += '<div class="examples-list">';
        examples.forEach(str => {
          // const displayStr = str === '' ? '(empty string)' : str;
          html += `<code>${JSON.stringify(str)}</code> `;
        });
        html += '</div></div>';

        container.innerHTML = html;
        container.style.display = 'block';
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
    })
  </script>
</body>

</html>
